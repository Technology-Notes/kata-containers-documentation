<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1304" height="954"><source><![CDATA[Participant Docker
#Participant "kata-runtime"
#Participant virtcontainers
#Participant shim
#Participant proxy
#Participant hypervisor
#Participant agent
Docker->"kata-runtime": create
"kata-runtime"->virtcontainers: CreateSandbox()
Note left of virtcontainers: Sandbox\nReady
virtcontainers->virtcontainers: createNetwork()
virtcontainers->virtcontainers: Execute PreStart Hooks
virtcontainers->hypervisor: Start VM (inside the netns)
hypervisor-->virtcontainers: VM started
virtcontainers->proxy: Start Proxy
proxy->hypervisor: Connect the VM
virtcontainers->agent: CreateSandbox()
agent-->virtcontainers: Sandbox Created
virtcontainers->agent: CreateContainer()
agent-->virtcontainers: Container Created
virtcontainers->shim: Start Shim
shim->agent: ReadStdout() (blocking call)
shim->agent: ReadStderr() (blocking call)
shim->agent: WaitProcess() (blocking call)
Note left of virtcontainers: Container\nReady
virtcontainers-->"kata-runtime": End of CreateSandbox()
"kata-runtime"-->Docker: End of create]]></source><desc/><defs><marker id="markerArrowBlock" markerHeight="5" markerWidth="5" orient="auto" refX="5" refY="2.5" viewBox="0 0 5 5"><path d="M 0 0 L 5 2.5 L 0 5 z"/></marker><marker id="markerArrowOpen" markerHeight="16" markerWidth="4" orient="auto" refX="9.6" refY="8" viewBox="0 0 9.6 16"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"/></marker></defs><g class="actor"><rect width="77.609" height="38" x="10" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="20" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">Docker</tspan></text></g><g class="actor"><rect width="77.609" height="38" x="10" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="20" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="20">Docker</tspan></text></g><line x1="48.805" x2="48.805" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="135.219" height="38" x="126.023" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="136.023" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="136.023">kata-runtime</tspan></text></g><g class="actor"><rect width="135.219" height="38" x="126.023" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="136.023" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="136.023">kata-runtime</tspan></text></g><line x1="193.633" x2="193.633" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="154.422" height="38" x="347.656" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="357.656" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="357.656">virtcontainers</tspan></text></g><g class="actor"><rect width="154.422" height="38" x="347.656" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="357.656" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="357.656">virtcontainers</tspan></text></g><line x1="424.867" x2="424.867" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="116.016" height="38" x="646.109" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="656.109" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="656.109">hypervisor</tspan></text></g><g class="actor"><rect width="116.016" height="38" x="646.109" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="656.109" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="656.109">hypervisor</tspan></text></g><line x1="704.117" x2="704.117" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="68.016" height="38" x="824.531" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="834.531" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="834.531">proxy</tspan></text></g><g class="actor"><rect width="68.016" height="38" x="824.531" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="834.531" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="834.531">proxy</tspan></text></g><line x1="858.539" x2="858.539" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="68.016" height="38" x="912.547" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="922.547" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="922.547">agent</tspan></text></g><g class="actor"><rect width="68.016" height="38" x="912.547" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="922.547" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="922.547">agent</tspan></text></g><line x1="946.555" x2="946.555" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="actor"><rect width="58.406" height="38" x="1215.805" y="20" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="1225.805" y="44.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1225.805">shim</tspan></text></g><g class="actor"><rect width="58.406" height="38" x="1215.805" y="896.406" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="1225.805" y="920.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="1225.805">shim</tspan></text></g><line x1="1245.008" x2="1245.008" y1="58" y2="896.406" fill="none" stroke="#000" style="stroke-width:2px"/><g class="signal"><text x="92.414" y="88.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="92.414">create</tspan></text><line x1="48.805" x2="193.633" y1="96" y2="96" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="237.234" y="126.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="237.234">CreateSandbox()</tspan></text><line x1="193.633" x2="424.867" y1="134" y2="134" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="77.219" height="47.203" x="327.648" y="154" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="332.648" y="173.516" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="332.648">Sandbox</tspan><tspan x="332.648" dy="1.2em">Ready</tspan></text></g><g class="signal"><text x="449.867" y="235.203" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="449.867">createNetwork()</tspan></text><line x1="424.867" x2="444.867" y1="221.203" y2="221.203" fill="none" stroke="#000" style="stroke-width:2px"/><line x1="444.867" x2="444.867" y1="221.203" y2="244.203" fill="none" stroke="#000" style="stroke-width:2px"/><line x1="444.867" x2="424.867" y1="244.203" y2="244.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="449.867" y="273.203" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="449.867">Execute PreStart Hooks</tspan></text><line x1="424.867" x2="444.867" y1="259.203" y2="259.203" fill="none" stroke="#000" style="stroke-width:2px"/><line x1="444.867" x2="444.867" y1="259.203" y2="282.203" fill="none" stroke="#000" style="stroke-width:2px"/><line x1="444.867" x2="424.867" y1="282.203" y2="282.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="434.867" y="307.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="434.867">Start VM (inside the netns)</tspan></text><line x1="424.867" x2="704.117" y1="315.203" y2="315.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="516.484" y="345.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="516.484">VM started</tspan></text><line x1="704.117" x2="424.867" y1="353.203" y2="353.203" fill="none" stroke="#000" style="stroke-width:2px;stroke-dasharray:6px,2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="588.891" y="383.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="588.891">Start Proxy</tspan></text><line x1="424.867" x2="858.539" y1="391.203" y2="391.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="714.117" y="421.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="714.117">Connect the VM</tspan></text><line x1="858.539" x2="704.117" y1="429.203" y2="429.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="613.695" y="459.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="613.695">CreateSandbox()</tspan></text><line x1="424.867" x2="946.555" y1="467.203" y2="467.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="613.695" y="497.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="613.695">Sandbox Created</tspan></text><line x1="946.555" x2="424.867" y1="505.203" y2="505.203" fill="none" stroke="#000" style="stroke-width:2px;stroke-dasharray:6px,2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="604.094" y="535.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="604.094">CreateContainer()</tspan></text><line x1="424.867" x2="946.555" y1="543.203" y2="543.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="604.094" y="573.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="604.094">Container Created</tspan></text><line x1="946.555" x2="424.867" y1="581.203" y2="581.203" fill="none" stroke="#000" style="stroke-width:2px;stroke-dasharray:6px,2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="786.93" y="611.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="786.93">Start Shim</tspan></text><line x1="424.867" x2="1245.008" y1="619.203" y2="619.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="961.359" y="649.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="961.359">ReadStdout() (blocking call)</tspan></text><line x1="1245.008" x2="946.555" y1="657.203" y2="657.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="961.359" y="687.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="961.359">ReadStderr() (blocking call)</tspan></text><line x1="1245.008" x2="946.555" y1="695.203" y2="695.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="956.555" y="725.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="956.555">WaitProcess() (blocking call)</tspan></text><line x1="1245.008" x2="946.555" y1="733.203" y2="733.203" fill="none" stroke="#000" style="stroke-width:2px;marker-end:url(#markerArrowBlock)"/></g><g class="note"><rect width="96.422" height="47.203" x="308.445" y="753.203" fill="#fff" stroke="#000" style="stroke-width:2px"/><text x="313.445" y="772.719" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="313.445">Container</tspan><tspan x="313.445" dy="1.2em">Ready</tspan></text></g><g class="signal"><text x="203.633" y="830.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="203.633">End of CreateSandbox()</tspan></text><line x1="424.867" x2="193.633" y1="838.406" y2="838.406" fill="none" stroke="#000" style="stroke-width:2px;stroke-dasharray:6px,2px;marker-end:url(#markerArrowBlock)"/></g><g class="signal"><text x="58.805" y="868.922" style="font-size:16px;font-family:&quot;Andale Mono&quot;,monospace"><tspan x="58.805">End of create</tspan></text><line x1="193.633" x2="48.805" y1="876.406" y2="876.406" fill="none" stroke="#000" style="stroke-width:2px;stroke-dasharray:6px,2px;marker-end:url(#markerArrowBlock)"/></g></svg>